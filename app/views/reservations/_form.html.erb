<%= form_for([@room, @room.reservations.new]) do |f| %>
 <div class="row">
        <div class="col-md-12 price_tag">
           <ul class="list-group">
              <li class="list-group-item d-flex justify-content-between align-items-center">
                Par nuit
                <span class="badge badge-primary badge-pill"><%= @room.price %> €</span>
              </li>
             </ul> 
       </div>     
 </div>            
    <div class="row">
        <div class="col-md-6">
            <label>Arrivée</label>
            <%= f.text_field :str_date, readonly: 'true', placeholder: 'jj/mm/aaaa', class:"form-control" %>
        </div>  
    <div class="col-md-6">
            <label>Départ</label>
            <%= f.text_field :end_date, readonly: 'true', placeholder: 'jj/mm/aaaa', class:"form-control" %>
        </div>            
    </div>
    
    <div id="preview" style="display: none">
        <table class="reservation-table">
            <tbody>
                <tr>
                    <td>Nuit(s)</td>
                    <td><span id="reservation_days"></span></td>
                </tr>
                <tr>
                    <td>Total</td>
                    <td><span id="reservation_sum"></span></td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <%= f.hidden_field :room_id, value: @room.id %>
    <%= f.hidden_field :price, value: @room.price %>
    <%= f.hidden_field :total, id:'reservation_total' %>
    
    <%= f.submit "Réserver", class:"btn btn-success btn-block" %>
    
<% end %>

  <script>
  $( function() {
      $.ajax({
          url: '/preload',
          date: {'room_id': <%= @room.id %>},
          dataType: 'json',
          success: function(data) {
              $.each(data, function(arrID, arrValue){
                  for(var d = new Date(arrValue.str_date); d <= new Date(arrValue.end_date);
                  d.setDate(d.getDate() +1)){
                      console.log(d);
                  }
              })
          }
      });
    $( "#reservation_str_date" ).datepicker({
        dateFormat: 'dd-mm-yy',
        monthNames: ['Janvier','Février','Mars','Avril','Mai','Juin','Juillet','Août',
        'Septembre','Octobre','Novembre','Décembre'],
        dayNamesMin: ['D','L','M','M','J','V','S']
    });
    $( "#reservation_end_date" ).datepicker({
        dateFormat: 'dd-mm-yy',
        monthNames: ['Janvier','Février','Mars','Avril','Mai','Juin','Juillet','Août',
        'Septembre','Octobre','Novembre','Décembre'],
        dayNamesMin: ['D','L','M','M','J','V','S']
    });
  })
  </script>